<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <title>Asteroids</title>
</head>
<body>
<div id='game' style='
    display: flex;
    justify-content: center;
    '>
    <canvas id='canvas' height='400' width='600' style='
        margin-top: 100px;
        background-color: black;
        outline: darkgrey 3px solid;
        border-radius: 10px;
        box-shadow: 10px 10px 18px rgba(0, 0, 0, 0.4);
    '/>
</div>
<script async>
  const canvas = document.getElementById('canvas')
  const ctx = canvas.getContext('2d')

  class Player {
    constructor() {
      this.x = canvas.width / 2
      this.y = canvas.height / 2
      this.velocity = {x: 0, y: 0}
      this.rotation = 270
      this.cooldown = 10

      this.draw()
    }

    get vertices() {
      const x = this.x
      const y = this.y
      const rotation = this.rotation

      const x1 = x + 12.5 * Math.cos(rotation * Math.PI / 180)
      const y1 = y + 12.5 * Math.sin(rotation * Math.PI / 180)

      const x2 = x + 7.5 * Math.cos((rotation + 120) * Math.PI / 180)
      const y2 = y + 7.5 * Math.sin((rotation + 120) * Math.PI / 180)

      const x3 = x + 7.5 * Math.cos((rotation + 240) * Math.PI / 180)
      const y3 = y + 7.5 * Math.sin((rotation + 240) * Math.PI / 180)

      return [
        {x: x1, y: y1},
        {x: x2, y: y2},
        {x: x3, y: y3}
      ]
    }

    rotate(direction) {
      const angle = (direction ? 1 : -1) * 3.5
      this.rotation += angle
    }

    accelerate(direction) {
      const acceleration = direction ? -0.1 : 0.11
      const radians = this.rotation * Math.PI / 180

      this.velocity.x += acceleration * Math.cos(radians)
      this.velocity.y += acceleration * Math.sin(radians)
    }

    shoot() {
      if (this.cooldown-- > 0)
        return
      const radians = this.rotation * Math.PI / 180
      const x = this.x + 12.5 * Math.cos(radians)
      const y = this.y + 12.5 * Math.sin(radians)
      const velocity = {
        x: 5 * Math.cos(radians),
        y: 5 * Math.sin(radians)
      }
      projectiles.push(new Projectile(x, y, this.rotation, velocity))
      this.cooldown = 10
    }

    draw() {
      const [x1, y1] = Object.values(this.vertices[0])
      const [x2, y2] = Object.values(this.vertices[1])
      const [x3, y3] = Object.values(this.vertices[2])

      ctx.beginPath()
      ctx.moveTo(x1, y1)
      ctx.lineTo(x2, y2)
      ctx.lineTo(x3, y3)
      ctx.closePath()
      ctx.strokeStyle = '#FFFFFF'
      ctx.stroke()
    }
    update() {
      this.x += this.velocity.x
      this.y += this.velocity.y

      if (this.x > canvas.width)
        this.x = 0
      else if (this.x < 0)
        this.x = canvas.width
      if (this.y > canvas.height)
        this.y = 0
      else if (this.y < 0)
        this.y = canvas.height

      this.velocity.x *= 0.99
      this.velocity.y *= 0.99

      this.draw()
    }
  }

  class Projectile {
    constructor(x, y, rotation, velocity) {
      this.x = x
      this.y = y
      this.rotation = rotation
      this.velocity = velocity
      this.draw()
    }

    draw() {
      ctx.beginPath()
      ctx.moveTo(this.x, this.y)
      ctx.lineTo(
        this.x + 5 * Math.cos(this.rotation * Math.PI / 180),
        this.y + 5 * Math.sin(this.rotation * Math.PI / 180))
      ctx.strokeStyle = '#FFFFFF'
      ctx.stroke()
    }

    update() {
      if (this.x > canvas.width || this.x < 0 || this.y > canvas.height || this.y < 0)
        projectiles.splice(projectiles.indexOf(this), 1)
      this.x += this.velocity.x
      this.y += this.velocity.y

      this.draw()
    }
  }

  class Asteroid {
    constructor() {
      const side = Math.floor(Math.random() * 4)
      this.x = side % 2 ? Math.random() * canvas.width : side ? 0 : canvas.width
      this.y = side % 2 ? 0 : Math.random() * canvas.height
      this.radius = 10
      this.velocity = {
        x: Math.random() * 4 - 1,
        y: Math.random() * 4 - 1
      }

      this.draw()
    }

    draw() {
      ctx.beginPath()
      ctx.arc(this.x, this.y, this.radius, 0, 2 * Math.PI)
      ctx.strokeStyle = '#FFFFFF'
      ctx.stroke()
    }

    update() {
      if (this.x > canvas.width || this.x < 0 || this.y > canvas.height || this.y < 0)
        asteroids.splice(asteroids.indexOf(this), 1)
      this.x += this.velocity.x
      this.y += this.velocity.y

      this.draw()
    }
  }

  const player = new Player()
  const projectiles = []
  const asteroids = []
  let asteroidInterval = 100

  const keyState = {
    w: {active: false, action: _ => player.accelerate()},
    a: {active: false, action: _ => player.rotate()},
    s: {active: false, action: _ => player.accelerate('reverse')},
    d: {active: false, action: _ => player.rotate('reverse')},
    c: {active: false, action: _ => player.shoot()}
  }

  document.addEventListener('keydown', keyEvent => {
    if (Object.keys(keyState).includes(keyEvent.key))
      keyState[keyEvent.key].active = true
  })

  document.addEventListener('keyup', keyEvent => {
    if (Object.keys(keyState).includes(keyEvent.key))
      keyState[keyEvent.key].active = false
  })
  const update = _ => {
    ctx.clearRect(0, 0, canvas.width, canvas.height)
    player.update()
    projectiles.forEach(projectile => projectile.update())
    asteroids.forEach(asteroid => asteroid.update())
    if (asteroidInterval-- < 0) {
      asteroids.push(new Asteroid())
      asteroidInterval = 100
    }
    Object.values(keyState).forEach(state => {
      if (state.active)
        state.action()
    })
    window.requestAnimationFrame(update)
  }

  window.requestAnimationFrame(update)
</script>
</body>
</html>